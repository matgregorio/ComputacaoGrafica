<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8'>
    <title>Page Title</title>
    <style>
        body{ margin: 0;}
        .explicacao{
            background-color: black;
            color: white;
            font-size: 1.1em;
        }

        b{
            color: yellow;
        }
    </style>
</head>
<body>
    <div align="center" class="explicacao">
        Movimente o mouse para girar
        Aperte <b>MEIO</b> para o Zoom.
        Visão panorâmica com <b>DIREITA</b>.
    </br>
    </div>
    <script type="module">
        import * as THREE from "/build/three.module.js";
        import Stats from "/jsm/libs/stats.module.js";
        import { GUI } from "/jsm/libs/dat.gui.module.js";
        import {TrackballControls} from '/jsm/controls/TrackballControls.js';
        import {VertexNormalsHelper} from '/jsm/helpers/VertexNormalsHelper.js';
        
        //definindo a largura e altura da tela
        let SCREEN_WIDTH = window.innerWidth;
        let SCREEN_HEIGHT = window.innerHeight;
        let aspect_ratio = SCREEN_WIDTH / SCREEN_HEIGHT;//relação da leitura

        let camera_perspective, camera_ortho, active_camera, scene, renderer, stats, controls;
        let sphere, YellowSphereNormal, plane, torusKnot, dodecahedron;
        let spotLight, spotLightBlue, spotLightBlueHelper, spotLightGreen, spotLightGreenHelper;
        let spotLightRed, spotLightRedHelper, ambientLight, sunLight, sunLightHelper, lampLight;
        let spotLightMovementRight = true;

        const uniforms = {
            u_resolution: {type: "v2", value: new THREE.Vector2()},
            u_time:{type: "f", value: 1.0},
            u_mouse:{type: "v2", value: new THREE.Vector2()},
        }
        const clock = new THREE.Clock();

        const params = {
            sphereControls:{
                showWireframe: false,
                opacity: 1.0,
                showNormal: false,
            },
            boxControls:{
                showNormal: false,
            }
        };

        function init(){
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x333333);
            camera_perspective = new THREE.PerspectiveCamera(45,aspect_ratio,0.1,1000);

            active_camera = camera_perspective;
            active_camera.position.set(1,0.5,10);

            let axesHelper = new THREE.AxesHelper(10);
            scene.add(axesHelper);
        //fazer os objetos

        function createShaderObject(){
            const basicVertexShader = '
            void main(){
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
            }
            ';

            const basicFragmentShader = '
            void main(){
                gl_FragColor = vec4(0.0,0.0,1.0,1.0);
            }
            ';

            const scaleVertexShader = '
            void main(){
                vec3 scale = vec3(2.0,1.0,1.0);
                gl_Position = projectionMatrix * modelViewMatrix * vec4(position * scale, 1.0);
            }
            ';

            const redAnimationFragmentShader = '
            uniform vec2 u_mouse;
            uniform vec2 u_resolution;
            uniform float u_time;
            
            void main(){
                gl_FragColor = vec4(abs(sin(u_time)), 0.0,0.0,1.0);
            }
            ';
            const sphereGeometry = new THREE.SphereGeometry(1,128,256);
            const planeGeometry = new THREE.PlaneBufferGeometry(4,4);
            const material = new THREE.ShaderMaterial({
                vertexShader: scaleVertexShader,
                fragmentShader: redAnimationFragmentShader,
                uniforms
            });

            shaderMesh = new THREE.Mesh(sphereGeometry, material);
            scene.add(shaderMesh);

            shaderMesh.position.set(1,1,1);
        }
        createShaderObject();

            renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);
            document.body.appendChild(renderer.domElement);

            stats = new Stats();
            document.body.appendChild(stats.dom);

            const params = {
                orthographicCamera: false
            };

            //const gui = new GUI();
            
            createControls(camera_perspective);
            window.addEventListener('resize', onWindowsResize);
        }

        function onWindowsResize(){
            SCREEN_WIDTH = window.innerWidth;
            SCREEN_HEIGHT = window.innerHeight;
            aspect_ratio = SCREEN_WIDTH / SCREEN_HEIGHT;

            renderer.setSize(SCREEN_WIDTH, SCREEN_HEIGHT);

            active_camera.aspect = aspect_ratio;
            active_camera.updateProjectionMatrix();
        }

        function createControls(camera){
            active_camera = camera;
            active_camera.position.set(1,0.5,10);

            controls = new TrackballControls(active_camera, renderer.domElement);

            controls.rotateSpeed = 1.0;
            controls.zoomSpeed = 1.2;
            controls.panSpeed = 0.8;

            controls.keys = ['KeyA', 'KeyS', 'KeyD'];

        }

        const animate = function(){
            requestAnimationFrame(animate);

            uniforms.u_time.value = clock.getElapsedTime();

            controls.update();
            stats.update();
            renderer.render(scene, active_camera);
            
        };

        init();
        animate();
    </script>
</body>
</html>